<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Requests</title>
  <link href="/css/output.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">

    <!-- Header -->
  <header class="bg-white shadow px-6 py-3 flex items-center justify-between relative">
    <!-- Logo -->
    <div class="flex items-center gap-3">
      <img src="/img/e-gov-logo.png" alt="E-Gov Logo" class="h-10">
      <span class="text-xl font-bold text-gray-800">E-Gov Portal</span>
    </div>

    <!-- Nav Links -->
    <nav class="hidden md:flex gap-8 text-gray-700 font-medium absolute left-1/2 transform -translate-x-1/2">
      <a href="/citizen" class="hover:text-[#00bf63] transition">Dashboard</a>
      <a href="/citizen/apply" class="hover:text-[#00bf63] transition">Apply Service</a>
      <a href="/citizen/requests" class="hover:text-[#00bf63] transition">My Requests</a>
    </nav>

    <!-- User Actions -->
    <div class="flex items-center gap-6">
    
      <!-- Notification Icon -->
      <div class="relative">
        <button id="notifBtn" class="relative">
          <!-- Bell Icon -->
          <svg xmlns="http://www.w3.org/2000/svg" 
               fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
               class="w-7 h-7 text-gray-700 hover:text-[#00bf63] transition">
            <path stroke-linecap="round" stroke-linejoin="round" 
                  d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 
                     8.967 0 0118 9.75V9a6 6 0 10-12 0v.75a8.967 
                     8.967 0 01-2.311 6.022c1.733.64 
                     3.56 1.085 5.454 1.31m5.714 0a24.255 
                     24.255 0 01-5.714 0m5.714 0a3 3 0 
                     11-5.714 0" />
          </svg>
          <span class="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full"></span>
        </button>

        <!-- Dropdown -->
        <div id="notifDropdown" 
             class="hidden absolute right-0 mt-2 w-72 bg-white rounded-lg shadow-lg border">
          <ul class="max-h-64 overflow-y-auto divide-y divide-gray-200">
            <% if (notifications && notifications.length > 0) { %>
            <% } %>
            <% notifications.forEach(n => { %>
              <li class="p-3 text-sm <%= n.is_read ? 'bg-gray-50 text-gray-600' : 'bg-[#00bf63]/10 text-gray-900 font-semibold' %>">
                <%= n.message %>
                <small class="block text-xs text-gray-500 mt-1">
                  (<%= new Date(n.created_at).toLocaleString() %>)
                </small>
              </li>
            <% }) %>
          </ul>
        </div>
      </div>

        <!-- Login/Logout -->
      <% if (user) { %>
        <a href="/auth/logout" 
           class="text-gray-700 hover:text-[#00bf63] font-medium transition">
          Logout
        </a>
      <% } else { %>
        <a href="/auth/login" 
           class="text-gray-700 hover:text-[#00bf63] font-medium transition">
          Login
        </a>
      <% } %>

    </div>
  </header>

  <!-- Main -->
  <main class="flex-1 p-6">
    <div class="max-w-6xl mx-auto">
      <div class="bg-white rounded-xl shadow p-6">
        <h3 class="text-2xl font-bold text-gray-800 mb-6">My Requests</h3>

        <% if (requests.length === 0) { %>
          <div class="bg-blue-50 border border-blue-200 text-blue-700 p-4 rounded-lg">
            You have not submitted any requests yet.
          </div>
        <% } else { %>
          <div class="overflow-x-auto">
            <table class="w-full border border-gray-200 rounded-lg overflow-hidden text-sm">
              <thead class="bg-gray-100 text-gray-700">
                <tr>
                  <th class="px-4 py-2 text-left">No</th>
                  <th class="px-4 py-2 text-left">Service</th>
                  <th class="px-4 py-2 text-left">Department</th>
                  <th class="px-4 py-2 text-left">Status</th>
                  <th class="px-4 py-2 text-left">Submitted</th>
                  <th class="px-4 py-2 text-left">Actions</th>
                </tr>
              </thead>
              <tbody>
                 <% requests.forEach((r, i) => { %>
                  <tr class="border-t hover:bg-gray-50">
                  
                    <td class="px-4 py-2"><%= i + 1 %></td>
                    <td class="px-4 py-2"><%= r.service_name %></td>
                    <td class="px-4 py-2"><%= r.dept_name %></td>
                    <td class="px-4 py-2">
                      <span class="px-3 py-1 rounded-full text-xs font-semibold
                        <%= r.status === 'Approved' ? 'bg-green-100 text-green-700' : 
                            r.status === 'Rejected' ? 'bg-red-100 text-red-700' : 
                            'bg-yellow-100 text-yellow-700' %>">
                        <%= r.status %>
                      </span>
                    </td>
                    <td class="px-4 py-2"><%= new Date(r.created_at).toLocaleDateString() %></td>
                    <td class="px-4 py-2">
                      <a href="/citizen/requests/<%= r.id %>" 
                        class="text-[#00bf63] hover:underline font-medium">
                        Details
                      </a>
                    </td>
                  </tr>
                <% }) %>
              </tbody>
            </table>
          </div>
        <% } %>
      </div>
    </div>
  </main>

  <!-- Script for Dropdown -->
  <script>
    const notifBtn = document.getElementById("notifBtn");
    const notifDropdown = document.getElementById("notifDropdown");
    notifBtn.addEventListener("click", () => {
      notifDropdown.classList.toggle("hidden");
    });
  </script>

</body>
</html>
